```python
from keras.datasets import cifar10
```

### CIFAR-10 데이터셋 다운받기


```python
(x_train, y_train), (x_test, y_test) = cifar10.load_data()
```

    Downloading data from https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz
    170498071/170498071 [==============================] - 13s 0us/step
    


```python
x_train.shape,x_test.shape
```




    ((50000, 32, 32, 3), (10000, 32, 32, 3))




```python
y_train[0]
```




    array([6], dtype=uint8)




```python
x_train.min(), x_train.max()
```




    (0, 255)




```python
import matplotlib.pyplot as plt
import numpy as np
```

### CIFAR-10 데이터 그려보기


```python
np.random.seed(777)
class_names = ['airplane', 'automobile', 'bird', 'cat', 'deer', 'dog', 'frog', 'horse', 'ship', 'truck']
sample_size = 9
random_idx = np.random.randint(50000, size=sample_size)

plt.figure(figsize=(5,5))
for i, idx in enumerate(random_idx):
  plt.subplot(3,3,i+1)
  plt.xticks([])
  plt.yticks([])
  plt.imshow(x_train[idx], cmap='gray')
  plt.xlabel(class_names[int(y_train[idx])])
plt.show()
```


    
![png](09_cnn_cifar10_files/09_cnn_cifar10_8_0.png)
    


### CIFAR-10 데이터셋 전처리 과정


```python
# 채널별로 평균과 표준편차 구하기기
x_mean = np.mean(x_train,axis=(0,1,2))
x_std = np.std(x_train, axis = (0,1,2))

x_train = (x_train - x_mean) / x_std
x_test = (x_test - x_mean) / x_std
```


```python
x_train.min(), x_train.max()
```




    (-1.98921279913639, 2.1267894095169213)




```python
np.mean(x_train)
```




    5.2147915615326686e-17




```python
np.round(np.mean(x_train),1)
```




    0.0




```python
from sklearn.model_selection import train_test_split
```


```python
x_train, x_val, y_train, y_val = train_test_split(x_train,y_train,test_size=0.3,random_state=777)
```


```python
x_train.shape,x_val.shape
```




    ((35000, 32, 32, 3), (15000, 32, 32, 3))




```python
# from keras.utils import to_categorical
# y_train = to_categorical(y_train)
# y_test = to_categorical(y_test)
```


```python
from keras.models import Sequential
from keras.layers import Conv2D, MaxPool2D, Flatten, Dense
from keras.optimizers import Adam
```


```python
from keras import activations
from pyparsing import actions
model = Sequential([
    Conv2D(filters=32,kernel_size=3,padding='same',activation='relu',input_shape=(32,32,3)),
    Conv2D(filters=32,kernel_size=3,padding='same',activation='relu'),
    MaxPool2D(pool_size=(2,2),strides=2,padding='same'),

    Conv2D(filters=64,kernel_size=3,padding='same',activation='relu'),
    Conv2D(filters=64,kernel_size=3,padding='same',activation='relu'),
    MaxPool2D(pool_size=(2,2),strides=2,padding='same'),

    Conv2D(filters=128,kernel_size=3,padding='same',activation='relu'),
    Conv2D(filters=128,kernel_size=3,padding='same',activation='relu'),
    MaxPool2D(pool_size=(2,2),strides=2,padding='same'),

    Flatten(),
    Dense(256, activation = 'relu'),
    Dense(10, activation = 'softmax')
])
model.compile(optimizer = Adam(1e-4), loss = 'sparse_categorical_crossentropy',metrics=['acc'])
```


```python
history = model.fit(x_train,y_train,epochs=30,batch_size=32,validation_data=(x_val,y_val))
```

    Epoch 1/30
    1094/1094 [==============================] - 16s 7ms/step - loss: 1.6539 - acc: 0.4047 - val_loss: 1.4130 - val_acc: 0.4871
    Epoch 2/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 1.2898 - acc: 0.5387 - val_loss: 1.2232 - val_acc: 0.5573
    Epoch 3/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 1.1068 - acc: 0.6098 - val_loss: 1.0855 - val_acc: 0.6133
    Epoch 4/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.9706 - acc: 0.6607 - val_loss: 0.9639 - val_acc: 0.6596
    Epoch 5/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.8592 - acc: 0.7013 - val_loss: 0.9237 - val_acc: 0.6754
    Epoch 6/30
    1094/1094 [==============================] - 10s 9ms/step - loss: 0.7707 - acc: 0.7312 - val_loss: 0.8924 - val_acc: 0.6841
    Epoch 7/30
    1094/1094 [==============================] - 13s 12ms/step - loss: 0.6953 - acc: 0.7583 - val_loss: 0.8673 - val_acc: 0.7007
    Epoch 8/30
    1094/1094 [==============================] - 11s 10ms/step - loss: 0.6206 - acc: 0.7857 - val_loss: 0.8405 - val_acc: 0.7181
    Epoch 9/30
    1094/1094 [==============================] - 8s 7ms/step - loss: 0.5508 - acc: 0.8085 - val_loss: 0.8349 - val_acc: 0.7207
    Epoch 10/30
    1094/1094 [==============================] - 8s 8ms/step - loss: 0.4857 - acc: 0.8323 - val_loss: 0.8456 - val_acc: 0.7212
    Epoch 11/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.4200 - acc: 0.8560 - val_loss: 0.8722 - val_acc: 0.7201
    Epoch 12/30
    1094/1094 [==============================] - 7s 6ms/step - loss: 0.3539 - acc: 0.8784 - val_loss: 0.8894 - val_acc: 0.7289
    Epoch 13/30
    1094/1094 [==============================] - 7s 6ms/step - loss: 0.2986 - acc: 0.8975 - val_loss: 0.9334 - val_acc: 0.7221
    Epoch 14/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.2441 - acc: 0.9182 - val_loss: 1.0013 - val_acc: 0.7283
    Epoch 15/30
    1094/1094 [==============================] - 9s 8ms/step - loss: 0.1943 - acc: 0.9347 - val_loss: 1.0543 - val_acc: 0.7279
    Epoch 16/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.1567 - acc: 0.9466 - val_loss: 1.1665 - val_acc: 0.7185
    Epoch 17/30
    1094/1094 [==============================] - 7s 6ms/step - loss: 0.1292 - acc: 0.9566 - val_loss: 1.2691 - val_acc: 0.7174
    Epoch 18/30
    1094/1094 [==============================] - 8s 8ms/step - loss: 0.1079 - acc: 0.9641 - val_loss: 1.3670 - val_acc: 0.7092
    Epoch 19/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.0883 - acc: 0.9711 - val_loss: 1.3664 - val_acc: 0.7195
    Epoch 20/30
    1094/1094 [==============================] - 7s 6ms/step - loss: 0.0806 - acc: 0.9725 - val_loss: 1.4570 - val_acc: 0.7237
    Epoch 21/30
    1094/1094 [==============================] - 9s 8ms/step - loss: 0.0696 - acc: 0.9764 - val_loss: 1.5101 - val_acc: 0.7187
    Epoch 22/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.0661 - acc: 0.9766 - val_loss: 1.5854 - val_acc: 0.7173
    Epoch 23/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.0558 - acc: 0.9819 - val_loss: 1.6254 - val_acc: 0.7189
    Epoch 24/30
    1094/1094 [==============================] - 7s 6ms/step - loss: 0.0568 - acc: 0.9815 - val_loss: 1.6344 - val_acc: 0.7187
    Epoch 25/30
    1094/1094 [==============================] - 9s 8ms/step - loss: 0.0540 - acc: 0.9824 - val_loss: 1.6933 - val_acc: 0.7155
    Epoch 26/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.0519 - acc: 0.9822 - val_loss: 1.7652 - val_acc: 0.7133
    Epoch 27/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.0447 - acc: 0.9855 - val_loss: 1.7953 - val_acc: 0.7102
    Epoch 28/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.0478 - acc: 0.9837 - val_loss: 1.7936 - val_acc: 0.7169
    Epoch 29/30
    1094/1094 [==============================] - 7s 7ms/step - loss: 0.0442 - acc: 0.9852 - val_loss: 1.8437 - val_acc: 0.7233
    Epoch 30/30
    1094/1094 [==============================] - 7s 6ms/step - loss: 0.0374 - acc: 0.9878 - val_loss: 1.7594 - val_acc: 0.7243
    

### 신경망 시각화해보기
* 딥러닝 신경망의 큰 단점 중 하나는 모델을 쉽게 해석할 수 없다는 것.
* 의료나 금융에서는 소비자에게 설명 못하는 게 큰 단점
* 설명 가능한 AI(XAI:eXplainable AI) : 모델을 설명하기 위해 등장한 개념
* 모델이 학습한 특징을 시각화하는 게 하나의 방법이 될 수 있음
* 특성맵을 시각화해보는 작업 실습


```python
import matplotlib.pyplot as plt

his_dict = history.history
loss = his_dict['loss']
val_loss = his_dict['val_loss']

epochs = range(1, len(loss)+1)
fig = plt.figure(figsize=(10,5))

ax1 = fig.add_subplot(1,2,1)
ax1.plot(epochs,loss,color='blue',label='train_loss')
ax1.plot(epochs,val_loss,color='orange',label='val_loss')
ax1.set_title('train and val loss')
ax1.legend()

acc = his_dict['acc']
val_acc = his_dict['val_acc']

ax2 = fig.add_subplot(1,2,2)
ax2.plot(epochs,acc,color='blue',label='train_acc')
ax2.plot(epochs,val_acc,color='orange',label='val_acc')
ax2.set_title('train and val acc')
ax2.legend()

plt.show()
```


    
![png](09_cnn_cifar10_files/09_cnn_cifar10_22_0.png)
    



```python

```


```python

```




    ['conv2d',
     'conv2d_1',
     'max_pooling2d',
     'conv2d_2',
     'conv2d_3',
     'max_pooling2d_1',
     'conv2d_4',
     'conv2d_5',
     'max_pooling2d_2',
     'flatten',
     'dense',
     'dense_1']




```python
get_output = [layer.output for layer in model.layers]
get_output
```




    [<KerasTensor: shape=(None, 32, 32, 32) dtype=float32 (created by layer 'conv2d')>,
     <KerasTensor: shape=(None, 32, 32, 32) dtype=float32 (created by layer 'conv2d_1')>,
     <KerasTensor: shape=(None, 16, 16, 32) dtype=float32 (created by layer 'max_pooling2d')>,
     <KerasTensor: shape=(None, 16, 16, 64) dtype=float32 (created by layer 'conv2d_2')>,
     <KerasTensor: shape=(None, 16, 16, 64) dtype=float32 (created by layer 'conv2d_3')>,
     <KerasTensor: shape=(None, 8, 8, 64) dtype=float32 (created by layer 'max_pooling2d_1')>,
     <KerasTensor: shape=(None, 8, 8, 128) dtype=float32 (created by layer 'conv2d_4')>,
     <KerasTensor: shape=(None, 8, 8, 128) dtype=float32 (created by layer 'conv2d_5')>,
     <KerasTensor: shape=(None, 4, 4, 128) dtype=float32 (created by layer 'max_pooling2d_2')>,
     <KerasTensor: shape=(None, 2048) dtype=float32 (created by layer 'flatten')>,
     <KerasTensor: shape=(None, 256) dtype=float32 (created by layer 'dense')>,
     <KerasTensor: shape=(None, 10) dtype=float32 (created by layer 'dense_1')>]




```python
x_test[1].shape
```




    (32, 32, 3)




```python
visual_model = tf.keras.models.Model(inputs=model.input,outputs=get_output)

test_img = np.expand_dims(x_test[1], axis=0)
test_img.shape
```




    (1, 32, 32, 3)




```python
feature_maps = visual_model.predict(test_img)
feature_maps
```

    1/1 [==============================] - 0s 237ms/step
    




    [array([[[[0.18011117, 0.11986867, 0.23904455, ..., 0.        ,
               1.4439832 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.86897767, 0.70823   ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.88578975, 0.6867199 ],
              ...,
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.8950615 , 0.6905974 ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.88368636, 0.70329475],
              [0.        , 0.        , 0.        , ..., 0.31707034,
               0.15861881, 1.4167318 ]],
     
             [[0.4532425 , 0.30219433, 0.538186  , ..., 0.        ,
               0.5639302 , 0.        ],
              [0.01972118, 0.        , 0.        , ..., 0.        ,
               0.        , 0.17004783],
              [0.03296987, 0.        , 0.        , ..., 0.        ,
               0.        , 0.15299805],
              ...,
              [0.03670212, 0.        , 0.        , ..., 0.        ,
               0.        , 0.14639501],
              [0.03017237, 0.        , 0.        , ..., 0.        ,
               0.        , 0.1641426 ],
              [0.        , 0.22630475, 0.        , ..., 0.        ,
               0.        , 1.4711351 ]],
     
             [[0.45699885, 0.30330956, 0.5496688 , ..., 0.        ,
               0.5504005 , 0.        ],
              [0.02087615, 0.        , 0.        , ..., 0.        ,
               0.        , 0.14671437],
              [0.03329868, 0.        , 0.        , ..., 0.        ,
               0.        , 0.12853138],
              ...,
              [0.04157162, 0.        , 0.        , ..., 0.        ,
               0.        , 0.12361066],
              [0.03207926, 0.        , 0.        , ..., 0.        ,
               0.        , 0.1369745 ],
              [0.        , 0.23984441, 0.        , ..., 0.        ,
               0.        , 1.4649504 ]],
     
             ...,
     
             [[0.        , 0.        , 0.        , ..., 0.6024831 ,
               0.        , 0.79922456],
              [0.        , 0.        , 0.        , ..., 0.9119296 ,
               0.01021215, 0.7908234 ],
              [0.        , 0.        , 0.        , ..., 1.216786  ,
               0.46110442, 0.4392274 ],
              ...,
              [0.11707614, 0.        , 0.02893712, ..., 0.        ,
               0.10843325, 0.        ],
              [0.12313487, 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.07299721, 0.        , ..., 0.        ,
               0.        , 1.0065992 ]],
     
             [[0.        , 0.        , 0.        , ..., 0.64355654,
               0.        , 0.7815422 ],
              [0.        , 0.        , 0.        , ..., 0.8872402 ,
               0.221903  , 0.620162  ],
              [0.        , 0.        , 0.00719852, ..., 1.0816889 ,
               0.59847075, 0.40487754],
              ...,
              [0.14833751, 0.        , 0.0193269 , ..., 0.        ,
               0.        , 0.        ],
              [0.12633556, 0.        , 0.        , ..., 0.        ,
               0.        , 0.01369125],
              [0.        , 0.09061303, 0.        , ..., 0.        ,
               0.        , 1.0059972 ]],
     
             [[0.        , 0.        , 0.        , ..., 0.67539096,
               0.41962743, 0.52921987],
              [0.        , 0.        , 0.        , ..., 0.92217135,
               0.82878435, 0.3434599 ],
              [0.        , 0.        , 0.06390775, ..., 1.0450916 ,
               1.107088  , 0.22078833],
              ...,
              [0.34803843, 0.04692007, 0.03089971, ..., 0.        ,
               0.        , 0.08240156],
              [0.37445354, 0.10656272, 0.        , ..., 0.        ,
               0.        , 0.16786253],
              [0.        , 0.35954547, 0.        , ..., 0.        ,
               0.        , 0.7676549 ]]]], dtype=float32),
     array([[[[4.96610016e-01, 2.50590928e-02, 1.31284684e-01, ...,
               1.54108495e-01, 5.53354502e-01, 0.00000000e+00],
              [5.06224990e-01, 5.79201996e-01, 5.60792744e-01, ...,
               0.00000000e+00, 1.21033394e+00, 3.13774765e-01],
              [3.62707734e-01, 3.67824286e-01, 8.27682197e-01, ...,
               0.00000000e+00, 1.05521858e+00, 7.51847029e-02],
              ...,
              [3.65189105e-01, 3.77527744e-01, 8.27741742e-01, ...,
               0.00000000e+00, 1.05979383e+00, 8.23723152e-02],
              [1.05161190e-01, 2.71523684e-01, 7.90437698e-01, ...,
               0.00000000e+00, 1.29090071e-01, 2.49224871e-01],
              [0.00000000e+00, 1.43351302e-01, 7.51650095e-01, ...,
               0.00000000e+00, 2.50141621e-01, 6.77044570e-01]],
     
             [[0.00000000e+00, 0.00000000e+00, 3.35763782e-01, ...,
               2.54476994e-01, 0.00000000e+00, 1.87805831e-01],
              [0.00000000e+00, 3.72062683e-01, 6.32860243e-01, ...,
               4.39331792e-02, 2.97422782e-02, 6.07324243e-01],
              [0.00000000e+00, 2.56703734e-01, 7.60102630e-01, ...,
               0.00000000e+00, 0.00000000e+00, 2.61881560e-01],
              ...,
              [0.00000000e+00, 2.61342734e-01, 7.68661916e-01, ...,
               0.00000000e+00, 0.00000000e+00, 2.69643247e-01],
              [0.00000000e+00, 2.59696871e-01, 1.03417730e+00, ...,
               0.00000000e+00, 0.00000000e+00, 3.99879128e-01],
              [4.59483713e-02, 7.11690634e-04, 8.20723712e-01, ...,
               2.76311755e-01, 0.00000000e+00, 6.80155218e-01]],
     
             [[0.00000000e+00, 0.00000000e+00, 1.61681503e-01, ...,
               4.38367873e-01, 0.00000000e+00, 5.59890151e-01],
              [0.00000000e+00, 2.19695196e-01, 6.53225705e-02, ...,
               6.93038702e-02, 2.09196433e-02, 6.51762843e-01],
              [0.00000000e+00, 1.97099790e-01, 6.81665316e-02, ...,
               6.65515214e-02, 6.31843135e-02, 2.12273836e-01],
              ...,
              [0.00000000e+00, 1.99549362e-01, 7.10404888e-02, ...,
               8.20935518e-02, 5.46549782e-02, 2.21779764e-01],
              [0.00000000e+00, 3.15429837e-01, 2.69725740e-01, ...,
               0.00000000e+00, 0.00000000e+00, 3.10619205e-01],
              [3.95736575e-01, 8.30283016e-02, 1.19457997e-01, ...,
               3.67160827e-01, 0.00000000e+00, 2.03681350e-01]],
     
             ...,
     
             [[4.51196998e-01, 0.00000000e+00, 2.24731356e-01, ...,
               0.00000000e+00, 0.00000000e+00, 5.87280571e-01],
              [9.76604581e-01, 0.00000000e+00, 0.00000000e+00, ...,
               3.50945182e-02, 4.45940912e-01, 1.70030221e-02],
              [1.25661016e+00, 9.37970430e-02, 0.00000000e+00, ...,
               3.26855369e-02, 4.99787092e-01, 0.00000000e+00],
              ...,
              [0.00000000e+00, 8.91500860e-02, 1.74886495e-01, ...,
               0.00000000e+00, 6.75215572e-03, 3.41231316e-01],
              [0.00000000e+00, 2.19818279e-01, 2.54189581e-01, ...,
               0.00000000e+00, 0.00000000e+00, 4.03337210e-01],
              [2.20427305e-01, 6.05435334e-02, 1.85720474e-01, ...,
               1.78818047e-01, 0.00000000e+00, 2.92915523e-01]],
     
             [[6.29199386e-01, 4.71664183e-02, 0.00000000e+00, ...,
               0.00000000e+00, 0.00000000e+00, 4.88845110e-01],
              [1.34682000e+00, 3.60493928e-01, 0.00000000e+00, ...,
               1.40237167e-01, 1.03195064e-01, 0.00000000e+00],
              [1.63275397e+00, 4.71313149e-01, 0.00000000e+00, ...,
               1.67455345e-01, 1.11251198e-01, 0.00000000e+00],
              ...,
              [0.00000000e+00, 0.00000000e+00, 3.84738654e-01, ...,
               0.00000000e+00, 0.00000000e+00, 3.67263258e-01],
              [0.00000000e+00, 4.11766879e-02, 3.95576954e-01, ...,
               0.00000000e+00, 0.00000000e+00, 4.54255521e-01],
              [0.00000000e+00, 0.00000000e+00, 2.48995394e-01, ...,
               1.48839638e-01, 0.00000000e+00, 3.50630343e-01]],
     
             [[7.74828434e-01, 0.00000000e+00, 0.00000000e+00, ...,
               0.00000000e+00, 0.00000000e+00, 0.00000000e+00],
              [1.03085911e+00, 0.00000000e+00, 0.00000000e+00, ...,
               0.00000000e+00, 1.41086251e-01, 0.00000000e+00],
              [8.91611695e-01, 0.00000000e+00, 1.50698215e-01, ...,
               0.00000000e+00, 3.55198830e-01, 0.00000000e+00],
              ...,
              [0.00000000e+00, 1.33243933e-01, 1.12430453e-02, ...,
               1.23250961e-01, 0.00000000e+00, 1.78696185e-01],
              [0.00000000e+00, 1.14432544e-01, 6.37143329e-02, ...,
               1.85140908e-01, 0.00000000e+00, 2.11541444e-01],
              [1.76582202e-01, 5.48710302e-03, 0.00000000e+00, ...,
               4.06854838e-01, 0.00000000e+00, 0.00000000e+00]]]],
           dtype=float32),
     array([[[[5.06224990e-01, 5.79201996e-01, 6.32860243e-01, ...,
               2.54476994e-01, 1.21033394e+00, 6.07324243e-01],
              [3.63691300e-01, 3.77204895e-01, 8.27682197e-01, ...,
               0.00000000e+00, 1.06012928e+00, 2.69102603e-01],
              [3.62036169e-01, 3.76208514e-01, 8.24899316e-01, ...,
               0.00000000e+00, 1.05845547e+00, 2.67184287e-01],
              ...,
              [3.64180744e-01, 3.77383113e-01, 8.29326093e-01, ...,
               0.00000000e+00, 1.06288660e+00, 2.71573484e-01],
              [3.66960794e-01, 3.77527744e-01, 8.27741742e-01, ...,
               0.00000000e+00, 1.06550562e+00, 2.69643247e-01],
              [1.05161190e-01, 2.71523684e-01, 1.03417730e+00, ...,
               2.76311755e-01, 2.50141621e-01, 6.80155218e-01]],
     
             [[0.00000000e+00, 2.19695196e-01, 1.61681503e-01, ...,
               4.45457935e-01, 2.09196433e-02, 6.63265467e-01],
              [0.00000000e+00, 1.99111953e-01, 7.11340234e-02, ...,
               6.77721798e-02, 7.51067623e-02, 2.30465382e-01],
              [0.00000000e+00, 1.98910490e-01, 7.16393664e-02, ...,
               6.71001375e-02, 7.78263733e-02, 2.29726374e-01],
              ...,
              [0.00000000e+00, 1.99052617e-01, 6.46071807e-02, ...,
               8.10488313e-02, 9.14374217e-02, 2.23947346e-01],
              [0.00000000e+00, 2.01621309e-01, 7.10404888e-02, ...,
               8.23114216e-02, 9.22084376e-02, 2.29107618e-01],
              [3.95736575e-01, 3.27120364e-01, 2.69725740e-01, ...,
               3.67160827e-01, 0.00000000e+00, 3.11988741e-01]],
     
             [[0.00000000e+00, 1.99194238e-01, 1.75877333e-01, ...,
               4.12654519e-01, 1.69608295e-02, 6.54013097e-01],
              [0.00000000e+00, 2.09324881e-01, 7.80324712e-02, ...,
               1.44556180e-01, 6.88223168e-02, 2.32123733e-01],
              [0.00000000e+00, 2.02814326e-01, 7.63658807e-02, ...,
               1.06200591e-01, 6.98164776e-02, 2.28850543e-01],
              ...,
              [0.00000000e+00, 2.02724591e-01, 7.33805224e-02, ...,
               8.51987153e-02, 9.40787420e-02, 2.28923172e-01],
              [0.00000000e+00, 1.97001711e-01, 8.10441896e-02, ...,
               8.54668617e-02, 9.32348892e-02, 2.36392170e-01],
              [3.90266538e-01, 3.24499846e-01, 2.86060542e-01, ...,
               3.69820297e-01, 0.00000000e+00, 3.13079029e-01]],
     
             ...,
     
             [[8.48664999e-01, 2.35069543e-04, 2.89114147e-01, ...,
               0.00000000e+00, 7.10127592e-01, 1.47622392e-01],
              [8.63724232e-01, 1.12255290e-01, 1.26948178e-01, ...,
               1.96800649e-01, 9.06851530e-01, 0.00000000e+00],
              [8.22095990e-01, 1.98654696e-01, 0.00000000e+00, ...,
               2.65889704e-01, 7.19984114e-01, 0.00000000e+00],
              ...,
              [2.81108826e-01, 7.57921338e-02, 2.29451060e-01, ...,
               5.91698103e-02, 7.35707060e-02, 3.36926728e-01],
              [1.23863548e-01, 1.58975169e-01, 2.55243212e-01, ...,
               6.78439140e-02, 4.58123162e-02, 3.67348850e-01],
              [2.72688687e-01, 2.50553548e-01, 3.26865464e-01, ...,
               2.07096100e-01, 0.00000000e+00, 4.81795013e-01]],
     
             [[9.76604581e-01, 0.00000000e+00, 3.47638130e-01, ...,
               8.18738639e-02, 5.68853736e-01, 5.87280571e-01],
              [1.25661016e+00, 2.72215217e-01, 0.00000000e+00, ...,
               7.56124556e-02, 7.57615268e-01, 0.00000000e+00],
              [1.22128987e+00, 3.27852458e-01, 0.00000000e+00, ...,
               0.00000000e+00, 6.28587425e-01, 0.00000000e+00],
              ...,
              [3.00759226e-01, 1.13671064e-01, 1.40663207e-01, ...,
               1.53348483e-02, 5.96058592e-02, 3.21125746e-01],
              [1.12594306e-01, 2.03304812e-01, 1.74886495e-01, ...,
               7.36970901e-02, 6.15056083e-02, 3.41375679e-01],
              [2.82339573e-01, 2.73287654e-01, 2.54189581e-01, ...,
               1.99527949e-01, 0.00000000e+00, 4.03337210e-01]],
     
             [[1.34682000e+00, 3.60493928e-01, 0.00000000e+00, ...,
               1.40237167e-01, 1.41086251e-01, 4.88845110e-01],
              [1.63275397e+00, 5.71568906e-01, 4.94323641e-01, ...,
               1.67455345e-01, 5.29841065e-01, 0.00000000e+00],
              [1.65018284e+00, 6.99811995e-01, 6.39833093e-01, ...,
               2.50096582e-02, 6.35728180e-01, 0.00000000e+00],
              ...,
              [0.00000000e+00, 3.72688510e-02, 2.16922522e-01, ...,
               2.05063559e-02, 0.00000000e+00, 3.42392534e-01],
              [0.00000000e+00, 1.33243933e-01, 3.84738654e-01, ...,
               1.23250961e-01, 0.00000000e+00, 3.67263258e-01],
              [1.76582202e-01, 1.14432544e-01, 3.95576954e-01, ...,
               4.06854838e-01, 0.00000000e+00, 4.54255521e-01]]]],
           dtype=float32),
     array([[[[0.6904801 , 0.7253886 , 1.0374892 , ..., 0.83155286,
               0.28270218, 1.4287409 ],
              [1.2383205 , 0.9958187 , 1.0906566 , ..., 0.42728522,
               0.        , 1.4981174 ],
              [1.0843973 , 0.94990945, 0.97132015, ..., 0.5275062 ,
               0.        , 1.8067865 ],
              ...,
              [1.1118593 , 0.9475474 , 0.9520396 , ..., 0.5096066 ,
               0.        , 1.8054714 ],
              [1.0158682 , 0.83630735, 1.1973664 , ..., 0.6999513 ,
               0.        , 1.9137782 ],
              [1.2683048 , 0.03280846, 0.90760046, ..., 0.42972082,
               0.        , 1.0398911 ]],
     
             [[0.17509764, 0.10923924, 1.6051078 , ..., 0.41690934,
               1.0975095 , 1.891367  ],
              [0.22461605, 0.634026  , 2.3835857 , ..., 0.        ,
               1.4013447 , 1.9678829 ],
              [0.10042136, 0.4698335 , 2.254016  , ..., 0.        ,
               1.3188822 , 2.434133  ],
              ...,
              [0.15564632, 0.46439052, 2.1939652 , ..., 0.        ,
               1.267655  , 2.4018352 ],
              [0.1281684 , 0.352354  , 2.3782043 , ..., 0.        ,
               1.6411173 , 2.7122362 ],
              [0.49695164, 0.        , 1.9179063 , ..., 0.        ,
               0.64958656, 1.7660038 ]],
     
             [[0.        , 0.22209659, 1.8537145 , ..., 0.15606883,
               1.3157713 , 1.8809743 ],
              [0.0773631 , 0.887333  , 2.549867  , ..., 0.        ,
               1.4363866 , 1.8430356 ],
              [0.02922741, 0.52521354, 2.4362078 , ..., 0.        ,
               1.1795014 , 2.1077259 ],
              ...,
              [0.03466829, 0.5944406 , 2.4308155 , ..., 0.        ,
               1.1211596 , 2.107221  ],
              [0.14248437, 0.37948942, 2.435241  , ..., 0.        ,
               1.273711  , 2.3855314 ],
              [0.64488196, 0.        , 1.7990159 , ..., 0.        ,
               0.35772887, 1.3924346 ]],
     
             ...,
     
             [[1.9556463 , 0.        , 0.        , ..., 0.26092497,
               0.        , 0.        ],
              [0.5633907 , 0.        , 0.        , ..., 0.54444724,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.66041464,
               1.1051879 , 0.5891175 ],
              ...,
              [0.18015295, 0.82689226, 0.        , ..., 0.81669545,
               1.0276234 , 0.59353125],
              [0.07117418, 0.4846522 , 0.7883792 , ..., 0.46820918,
               1.0267404 , 1.4760147 ],
              [0.47018892, 0.        , 1.0954391 , ..., 0.00998924,
               0.5298741 , 1.0175519 ]],
     
             [[1.8320882 , 0.        , 0.        , ..., 0.09799501,
               0.        , 0.        ],
              [0.9675161 , 0.        , 0.        , ..., 0.3953553 ,
               0.        , 0.        ],
              [0.4940669 , 0.        , 0.        , ..., 1.0802938 ,
               0.42448467, 0.06751826],
              ...,
              [0.        , 0.7853834 , 0.37097603, ..., 0.367112  ,
               1.0358697 , 0.78692955],
              [0.02481907, 0.47073585, 1.3040893 , ..., 0.35769385,
               1.3038867 , 1.7620329 ],
              [0.56285805, 0.        , 1.1983539 , ..., 0.        ,
               0.62251925, 1.1489881 ]],
     
             [[1.7893305 , 0.        , 0.        , ..., 0.44799492,
               0.        , 0.        ],
              [1.9710522 , 0.2961138 , 0.        , ..., 1.2262357 ,
               0.        , 0.        ],
              [1.3526708 , 0.        , 0.        , ..., 1.9974763 ,
               0.        , 0.        ],
              ...,
              [0.        , 0.5781687 , 0.5802366 , ..., 0.08125255,
               0.97471964, 0.8327043 ],
              [0.04626232, 0.47641605, 0.9710069 , ..., 0.26923534,
               1.6312312 , 1.3992474 ],
              [0.05741424, 0.        , 0.7859413 , ..., 0.        ,
               1.1629772 , 0.8342478 ]]]], dtype=float32),
     array([[[[0.        , 0.        , 0.        , ..., 0.        ,
               0.5549005 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.4060388 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.9054078 , 0.        ],
              ...,
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.79457295, 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.8878261 , 0.        ],
              [0.        , 0.9281519 , 0.        , ..., 0.96974355,
               0.6045904 , 0.        ]],
     
             [[1.9527345 , 0.        , 0.        , ..., 0.        ,
               0.72855425, 0.        ],
              [1.2537191 , 0.        , 0.        , ..., 0.03332406,
               0.        , 0.        ],
              [1.8326916 , 0.12605588, 0.        , ..., 1.1088512 ,
               0.04470859, 0.        ],
              ...,
              [1.837656  , 0.        , 0.        , ..., 0.77878904,
               0.03619984, 0.        ],
              [1.3920112 , 0.        , 0.        , ..., 0.94407386,
               0.        , 0.        ],
              [0.        , 2.2771924 , 0.        , ..., 3.1932423 ,
               0.        , 0.85506475]],
     
             [[0.907293  , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.98675185,
               0.        , 0.        ],
              [0.42760283, 0.        , 0.        , ..., 2.2414656 ,
               0.        , 0.        ],
              ...,
              [0.00577278, 0.        , 0.        , ..., 1.7077218 ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 1.6514593 ,
               0.        , 0.        ],
              [0.        , 2.3129218 , 0.        , ..., 3.1447697 ,
               0.        , 0.        ]],
     
             ...,
     
             [[0.        , 4.2047024 , 3.1608677 , ..., 0.        ,
               1.8245744 , 1.1042031 ],
              [0.        , 0.8179307 , 0.4887422 , ..., 1.7756981 ,
               2.64622   , 1.5647045 ],
              [0.        , 0.        , 0.39076045, ..., 2.2809768 ,
               0.49674937, 1.1483524 ],
              ...,
              [1.3346324 , 0.        , 0.        , ..., 0.        ,
               0.89274275, 0.        ],
              [1.1060013 , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 1.2227631 , 0.        , ..., 0.80425614,
               0.        , 0.        ]],
     
             [[0.        , 3.1202197 , 4.528523  , ..., 0.        ,
               0.5365021 , 2.0222018 ],
              [0.        , 0.29110664, 0.7565127 , ..., 0.        ,
               2.1589115 , 2.4070108 ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.58251   , 1.3595657 ],
              ...,
              [2.9916544 , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [2.267587  , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.11841656, 0.55529225, 0.        , ..., 1.5913604 ,
               0.        , 0.38518792]],
     
             [[0.7459444 , 2.4435909 , 3.2777717 , ..., 0.        ,
               0.        , 0.38554382],
              [0.        , 1.6570979 , 0.20548233, ..., 0.        ,
               1.2457051 , 0.        ],
              [0.        , 0.        , 0.00853428, ..., 0.        ,
               0.4930261 , 0.        ],
              ...,
              [2.794024  , 0.20711845, 0.        , ..., 0.        ,
               0.        , 0.52466136],
              [2.4505217 , 0.        , 0.        , ..., 0.4136399 ,
               0.        , 0.675244  ],
              [1.0290104 , 0.6997399 , 0.        , ..., 2.048779  ,
               0.        , 1.4268426 ]]]], dtype=float32),
     array([[[[ 1.9527345 ,  0.        ,  0.        , ...,  0.03332406,
                0.72855425,  0.        ],
              [ 1.8326916 ,  0.12605588,  0.        , ...,  1.1088512 ,
                1.0023168 ,  0.        ],
              [ 1.790071  ,  0.        ,  0.        , ...,  0.8841815 ,
                1.0460768 ,  0.        ],
              ...,
              [ 3.2322063 ,  0.        ,  0.        , ...,  1.444645  ,
                1.3291583 ,  0.        ],
              [ 1.837656  ,  0.        ,  0.        , ...,  1.3957428 ,
                0.9183382 ,  0.        ],
              [ 1.3920112 ,  2.2771924 ,  0.        , ...,  3.1932423 ,
                0.8878261 ,  0.85506475]],
     
             [[ 0.907293  ,  0.        ,  0.        , ...,  2.2330592 ,
                0.        ,  0.        ],
              [ 0.42760283,  0.        ,  0.        , ...,  3.0151014 ,
                0.        ,  0.        ],
              [ 0.39668953,  0.83021677,  0.        , ...,  1.4502791 ,
                0.        ,  0.        ],
              ...,
              [ 0.        ,  0.        ,  0.        , ...,  2.7061603 ,
                1.4417229 ,  1.1521152 ],
              [ 0.8677901 ,  0.        ,  0.        , ...,  1.9897567 ,
                0.02533531,  0.        ],
              [ 0.        ,  2.3129218 ,  0.        , ...,  3.3631961 ,
                0.        ,  0.        ]],
     
             [[ 1.3855962 ,  0.        ,  0.        , ...,  4.129644  ,
                4.075748  ,  2.8950593 ],
              [ 0.        ,  0.        ,  0.        , ...,  3.5232086 ,
                2.6295214 ,  0.36187285],
              [ 0.96859205,  1.740901  ,  0.        , ...,  6.517387  ,
                0.        ,  2.1534808 ],
              ...,
              [ 0.        ,  0.        ,  0.        , ...,  4.6900344 ,
                2.0800543 ,  0.34449828],
              [ 0.6925814 ,  0.        ,  0.        , ...,  4.1460676 ,
                2.5965447 ,  2.064961  ],
              [ 0.        ,  2.0322375 ,  0.        , ...,  3.7739017 ,
                0.05550095,  0.        ]],
     
             ...,
     
             [[ 4.8806705 ,  3.529989  ,  2.8199527 , ...,  7.3940163 ,
                4.611609  ,  4.7318635 ],
              [ 1.1418538 ,  0.        ,  0.        , ...,  9.595075  ,
                3.4236407 ,  4.0559225 ],
              [ 0.        ,  0.        ,  0.8448318 , ..., 10.1085825 ,
                4.958327  ,  3.803131  ],
              ...,
              [ 0.        ,  0.        ,  0.9228435 , ...,  9.760182  ,
                4.0587635 ,  5.147961  ],
              [ 0.        ,  0.        ,  0.        , ...,  5.826559  ,
                3.822061  ,  3.0358002 ],
              [ 0.        ,  0.        ,  0.        , ...,  1.5812079 ,
                0.54595387,  0.3731845 ]],
     
             [[ 0.        ,  4.2047024 ,  3.1608677 , ...,  1.7756981 ,
                2.9501638 ,  1.5647045 ],
              [ 0.        ,  0.        ,  1.9814953 , ...,  3.1430736 ,
                1.6209986 ,  1.186241  ],
              [ 0.3793285 ,  0.37922978,  1.5281299 , ...,  2.5613253 ,
                4.196512  ,  0.58749247],
              ...,
              [ 0.        ,  0.        ,  1.8139669 , ...,  5.376534  ,
                3.5126574 ,  1.0665547 ],
              [ 1.3346324 ,  0.        ,  0.        , ...,  1.0354978 ,
                1.6321708 ,  0.20798264],
              [ 1.1060013 ,  1.2227631 ,  0.        , ...,  0.80425614,
                0.44696566,  0.        ]],
     
             [[ 0.7459444 ,  3.1202197 ,  4.528523  , ...,  0.        ,
                2.1589115 ,  2.4070108 ],
              [ 0.        ,  0.        ,  0.65564066, ...,  0.        ,
                1.2807033 ,  1.3595657 ],
              [ 0.        ,  0.31876525,  1.1869303 , ...,  0.42557454,
                2.4109097 ,  1.3551962 ],
              ...,
              [ 2.879958  ,  1.3347452 ,  0.        , ...,  0.        ,
                3.504082  ,  0.        ],
              [ 2.9916544 ,  1.1297836 ,  0.        , ...,  0.        ,
                0.22301859,  0.52466136],
              [ 2.4505217 ,  0.6997399 ,  0.        , ...,  2.048779  ,
                0.        ,  1.4268426 ]]]], dtype=float32),
     array([[[[4.0443444 , 2.5246751 , 0.        , ..., 1.7109786 ,
               4.3344636 , 0.        ],
              [1.7143623 , 1.6929523 , 1.2013682 , ..., 1.3212904 ,
               0.        , 0.        ],
              [1.3050082 , 0.6022715 , 1.5866178 , ..., 0.98019886,
               0.6142354 , 0.        ],
              ...,
              [0.9337194 , 2.2302065 , 1.3547721 , ..., 1.3760294 ,
               1.6041601 , 0.        ],
              [0.53267473, 3.0602107 , 1.863206  , ..., 1.1726419 ,
               0.        , 0.        ],
              [3.3584433 , 0.        , 2.2378123 , ..., 1.0977486 ,
               0.        , 0.        ]],
     
             [[4.3993826 , 4.0082197 , 0.        , ..., 4.19961   ,
               4.208218  , 0.        ],
              [0.        , 2.3641114 , 0.        , ..., 0.        ,
               0.37249914, 0.        ],
              [1.7562733 , 0.15696988, 1.1348459 , ..., 0.13840225,
               0.62594634, 0.        ],
              ...,
              [0.        , 0.9414256 , 0.        , ..., 0.96783423,
               2.360221  , 0.        ],
              [0.        , 4.4625735 , 0.        , ..., 0.16977668,
               1.7098576 , 0.        ],
              [1.3627852 , 1.0653718 , 0.5662129 , ..., 0.        ,
               0.        , 0.        ]],
     
             [[0.        , 3.826936  , 0.        , ..., 6.18668   ,
               8.031965  , 0.        ],
              [0.        , 3.354301  , 1.7729238 , ..., 1.7785662 ,
               3.6195798 , 0.        ],
              [0.82353854, 2.8129673 , 0.09198833, ..., 0.        ,
               3.9591923 , 0.        ],
              ...,
              [0.        , 4.3725047 , 0.        , ..., 1.0382526 ,
               4.806816  , 0.        ],
              [0.        , 4.32466   , 0.        , ..., 2.0033638 ,
               5.815658  , 0.        ],
              [0.        , 1.4035097 , 0.5308411 , ..., 0.        ,
               0.8679608 , 0.        ]],
     
             ...,
     
             [[0.        , 1.834169  , 0.        , ..., 1.5595511 ,
               0.        , 1.6879977 ],
              [0.        , 1.0965427 , 0.        , ..., 0.        ,
               0.        , 0.92596877],
              [0.        , 1.2915686 , 0.        , ..., 0.        ,
               2.9953198 , 0.        ],
              ...,
              [0.        , 0.        , 0.        , ..., 4.734869  ,
               0.        , 2.4863548 ],
              [0.        , 0.        , 0.        , ..., 2.2463715 ,
               0.97935   , 1.9070951 ],
              [0.        , 0.        , 0.61540914, ..., 1.3669895 ,
               1.4952756 , 2.7468424 ]],
     
             [[0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 3.0020666 ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 4.6124077 ],
              [0.        , 0.        , 0.        , ..., 2.3942463 ,
               6.98906   , 4.402082  ],
              ...,
              [0.        , 0.        , 0.        , ..., 5.6337204 ,
               3.8655562 , 3.8150668 ],
              [0.        , 0.        , 1.2181505 , ..., 4.144218  ,
               4.9830847 , 3.517577  ],
              [0.        , 0.        , 0.71780264, ..., 3.1349704 ,
               2.2976654 , 1.5419842 ]],
     
             [[0.        , 3.0556722 , 0.        , ..., 0.        ,
               0.        , 1.3757309 ],
              [0.        , 0.        , 0.        , ..., 0.8531475 ,
               0.        , 0.        ],
              [0.        , 0.        , 0.5140847 , ..., 2.7532673 ,
               0.        , 0.3247814 ],
              ...,
              [0.        , 0.        , 2.9786794 , ..., 4.4376707 ,
               0.        , 3.86132   ],
              [0.        , 0.        , 2.5193715 , ..., 5.962032  ,
               3.5243888 , 1.4578902 ],
              [0.        , 0.56928736, 0.        , ..., 3.189875  ,
               0.9084723 , 0.        ]]]], dtype=float32),
     array([[[[0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.02079045, 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 1.5662415 , ..., 0.        ,
               0.        , 0.        ],
              ...,
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 1.5068371 , ..., 0.        ,
               0.        , 0.        ]],
     
             [[0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.18263225, 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              ...,
              [0.        , 0.        , 0.        , ..., 0.19150786,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 2.5243402 ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 1.6285052 ]],
     
             [[0.        , 0.        , 0.        , ..., 0.        ,
               0.9480448 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               2.9303005 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.6819452 , 0.        ],
              ...,
              [0.        , 0.        , 0.        , ..., 0.        ,
               5.6683793 , 0.        ],
              [0.        , 0.        , 0.        , ..., 2.439044  ,
               3.559029  , 0.4060023 ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               5.6092577 , 3.8778906 ]],
     
             ...,
     
             [[0.        , 0.        , 0.        , ..., 2.9827182 ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 1.7156074 ,
               1.074251  , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              ...,
              [0.        , 0.        , 0.        , ..., 0.        ,
               3.473913  , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               3.1486657 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               1.3537947 , 0.        ]],
     
             [[0.        , 0.9806044 , 0.        , ..., 1.4370399 ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               3.6480923 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              ...,
              [0.        , 0.        , 0.        , ..., 0.        ,
               3.6690435 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               2.4971025 , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               2.359147  , 0.        ]],
     
             [[0.        , 5.5192885 , 0.        , ..., 0.        ,
               0.        , 1.2820486 ],
              [0.4761929 , 2.8887155 , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [2.0009532 , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              ...,
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.554313  ,
               0.        , 0.        ]]]], dtype=float32),
     array([[[[0.18263225, 0.        , 0.        , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 1.5662415 , ..., 0.        ,
               0.        , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.19150786,
               0.        , 0.        ],
              [0.        , 0.        , 1.5068371 , ..., 0.        ,
               0.        , 2.5243402 ]],
     
             [[0.        , 0.        , 0.        , ..., 1.4713016 ,
               8.62786   , 3.9567013 ],
              [0.        , 0.        , 0.        , ..., 1.5645448 ,
               8.918855  , 9.081608  ],
              [0.8984484 , 0.        , 0.        , ..., 0.        ,
               5.6683793 , 0.        ],
              [0.49739888, 0.        , 0.        , ..., 2.606919  ,
               5.6092577 , 4.2190647 ]],
     
             [[0.        , 0.        , 0.        , ..., 4.19464   ,
               4.1931524 , 3.887965  ],
              [0.        , 0.        , 0.        , ..., 6.750736  ,
               0.75138813, 3.5020592 ],
              [0.        , 0.        , 0.        , ..., 1.6916374 ,
               3.473913  , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               3.1486657 , 0.        ]],
     
             [[0.4761929 , 5.5192885 , 0.        , ..., 1.4370399 ,
               3.6480923 , 1.2820486 ],
              [2.0009532 , 0.        , 0.        , ..., 0.        ,
               0.19173199, 0.        ],
              [0.        , 0.        , 0.        , ..., 0.        ,
               4.868398  , 0.        ],
              [0.        , 0.        , 0.        , ..., 0.554313  ,
               2.4971025 , 0.        ]]]], dtype=float32),
     array([[0.18263225, 0.        , 0.        , ..., 0.554313  , 2.4971025 ,
             0.        ]], dtype=float32),
     array([[2.9378886e+00, 0.0000000e+00, 6.6817460e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 1.4867514e-02, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 2.6585217e+00, 7.8877845e+00,
             3.6903121e+00, 0.0000000e+00, 0.0000000e+00, 1.0128146e+01,
             0.0000000e+00, 3.8180788e+00, 6.1482053e+00, 8.1222048e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 1.3164527e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             1.3418922e+01, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             1.7444231e+01, 1.3382767e+01, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 1.8506011e+00, 0.0000000e+00, 5.0852938e+00,
             2.5097303e+00, 3.9946764e+00, 9.3562107e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             1.4273323e+00, 0.0000000e+00, 0.0000000e+00, 4.9112961e-01,
             0.0000000e+00, 0.0000000e+00, 1.8731313e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             1.2123903e+01, 8.5285282e+00, 8.0093775e+00, 8.1616080e-01,
             6.3760762e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             1.9419501e+00, 0.0000000e+00, 3.6290771e-01, 0.0000000e+00,
             3.9994280e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             6.0709510e+00, 5.9525514e-01, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 1.6725048e-01, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 1.1639932e+00, 1.8954256e+01,
             0.0000000e+00, 1.6571565e+00, 0.0000000e+00, 5.7365952e+00,
             2.7948728e+00, 0.0000000e+00, 7.1066232e+00, 2.3247507e+00,
             4.2369237e+00, 0.0000000e+00, 0.0000000e+00, 2.3645791e-01,
             0.0000000e+00, 5.0753083e+00, 5.6046140e-01, 0.0000000e+00,
             5.5945477e+00, 3.5152626e+00, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 5.9110074e+00,
             0.0000000e+00, 4.2553353e+00, 8.8290852e-01, 0.0000000e+00,
             0.0000000e+00, 9.2079926e+00, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 4.2324033e+00, 2.0517142e+00, 5.3125151e-02,
             6.0222182e+00, 0.0000000e+00, 0.0000000e+00, 1.9667417e+00,
             4.4616213e+00, 0.0000000e+00, 1.2785133e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 2.8069894e+00,
             2.9811785e+00, 2.3516374e+00, 0.0000000e+00, 0.0000000e+00,
             2.3077279e-01, 2.6209328e+00, 5.0709858e+00, 3.7999961e+00,
             0.0000000e+00, 2.5994446e+00, 8.6246605e+00, 6.0608172e-01,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             3.7132387e+00, 0.0000000e+00, 7.3774924e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 4.4166166e-01, 1.6796160e+00,
             4.3730717e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 4.3473883e+00, 1.2554841e-01,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 5.0768929e+00, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 2.8557155e+00, 5.8154545e+00, 4.9924490e-01,
             0.0000000e+00, 1.2889435e+01, 1.4767971e+00, 1.1624109e+00,
             9.3198242e+00, 0.0000000e+00, 0.0000000e+00, 8.3798084e+00,
             3.2695559e-01, 0.0000000e+00, 1.5446540e+00, 0.0000000e+00,
             0.0000000e+00, 6.0385662e-01, 0.0000000e+00, 5.3537607e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 4.1481681e+00,
             6.3780732e-02, 8.3472449e-01, 2.2374806e+00, 6.5023437e+00,
             2.6411397e+00, 5.8551741e+00, 0.0000000e+00, 0.0000000e+00,
             1.8585193e+00, 3.6688178e+00, 4.4432364e+00, 4.3926110e+00,
             0.0000000e+00, 1.0817186e+01, 5.6737888e-01, 0.0000000e+00,
             0.0000000e+00, 0.0000000e+00, 8.7868595e+00, 1.9459100e+00,
             1.4015390e+00, 8.1779747e+00, 1.4913027e-01, 9.2104263e+00,
             0.0000000e+00, 0.0000000e+00, 3.2263563e+00, 0.0000000e+00,
             0.0000000e+00, 1.3824118e+00, 0.0000000e+00, 0.0000000e+00,
             8.9440880e+00, 0.0000000e+00, 7.4883227e+00, 0.0000000e+00,
             0.0000000e+00, 4.3743086e+00, 0.0000000e+00, 0.0000000e+00,
             2.3384564e+00, 0.0000000e+00, 1.3910558e+00, 4.4367509e+00,
             0.0000000e+00, 0.0000000e+00, 6.0421386e+00, 0.0000000e+00]],
           dtype=float32),
     array([[1.2875847e-06, 3.2304601e-05, 7.1143877e-18, 1.6818563e-15,
             1.6485328e-16, 5.8109096e-20, 1.4646773e-14, 8.3368038e-20,
             9.9996638e-01, 2.6823592e-08]], dtype=float32)]




```python
for layer_name,feature_map in zip(get_layer_name,feature_maps):
  # Dense층은 제외
  if (len(feature_map.shape)==4):
    img_size = feature_map.shape[1]
    features = feature_map.shape[-1]
    display_grid = np.zeros((img_size,img_size*features))
    # 각 특성맵을 이어붙여서 반복함.
    for i in range(features):
      x = feature_map[0,:,:,i]
      x -= x.mean()
      x /= x.std()
      x *= 64
      x += 128
      x = np.clip(x,0,255).astype('uint8')
      display_grid[:,i*img_size:(i+1)*img_size] = x # 그리드에 특성맵을 한장씩 붙이는 위치를 지정해준다.
    plt.figure(figsize=(features,2+1./features))
    plt.title(layer_name,fontsize=20)
    plt.grid(False)
    plt.imshow(display_grid,aspect='auto')
```

    <ipython-input-26-24ed10875a76>:11: RuntimeWarning: invalid value encountered in true_divide
      x /= x.std()
    


    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_1.png)
    



    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_2.png)
    



    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_3.png)
    



    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_4.png)
    



    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_5.png)
    



    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_6.png)
    



    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_7.png)
    



    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_8.png)
    



    
![png](09_cnn_cifar10_files/09_cnn_cifar10_29_9.png)
    

